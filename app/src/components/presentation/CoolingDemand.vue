<template>
  <ComponentBase
    component="cooling-demand"
    x="1067"
    y="521"
    width="114"
    height="114"
    viewBox="-1 -1 114 114"
  >
    <rect
      width="112"
      height="112"
      rx="56"
      fill="white"
      stroke="#E6E6E6"
      stroke-width="1"
    />
    <circle
      cx="56"
      cy="56"
      r="44"
      fill="white"
      class="fill"
      stroke="#ECD2D4"
      stroke-width="4"
    />
    <text
      fill="#757171"
      xml:space="preserve"
      style="white-space: pre"
      font-size="12"
      font-weight="bold"
      letter-spacing="0em"
    >
      <tspan
        x="35.625"
        y="61.961"
      >
        Cooling
      </tspan>
    </text>
    <text
      fill="#757171"
      xml:space="preserve"
      style="white-space: pre"
      font-size="12"
      font-weight="bold"
      letter-spacing="0em"
    >
      <tspan
        x="34.043"
        y="73.961"
      >
        demand
      </tspan>
    </text>
    <text
      fill="#756B61"
      xml:space="preserve"
      style="white-space: pre"
      font-family="DMMono"
      font-size="10"
      letter-spacing="0em"
    >
      <AnimatedNumber
        tag="tspan"
        text-anchor="end"
        x="54"
        y="86.801"
        :to="value"
        :format="formattedInt"
      />
    </text>
    <text
      fill="#756B61"
      xml:space="preserve"
      style="white-space: pre"
      font-size="9"
      letter-spacing="0em"
    >
      <tspan
        x="58"
        y="86.801"
        >{{ unit }}</tspan
      >
    </text>
    <path
      d="M66.3873 40.2225L64.7482 39.2769L66.0091 38.9374C66.4067 38.8308 66.6444 38.4186 66.5377 38.0209L66.3437 37.2983C66.237 36.9007 65.8248 36.6631 65.4272 36.7698L61.9938 37.6911L58.895 35.8969L61.9889 34.1074L65.4223 35.0288C65.82 35.1355 66.2322 34.8979 66.3388 34.5002L66.5328 33.7777C66.6395 33.38 66.4019 32.9678 66.0042 32.8612L64.7434 32.5217L66.3825 31.5761C66.7413 31.3675 66.8626 30.9117 66.6589 30.5528L65.9072 29.2532C65.6987 28.8943 65.2429 28.7731 64.884 28.9768L63.2449 29.9224L63.5844 28.6616C63.6911 28.2639 63.4535 27.8517 63.0558 27.745L62.3332 27.5511C61.9356 27.4444 61.5234 27.682 61.4167 28.0796L60.4953 31.513L57.4499 33.2685V29.5102L60.054 26.9061C60.3547 26.6054 60.3547 26.1108 60.054 25.8101L59.506 25.2621C59.2054 24.9615 58.7107 24.9615 58.4101 25.2621L57.4499 26.2175V24.2583C57.4499 23.8316 57.1007 23.4824 56.674 23.4824H55.1222C54.6954 23.4824 54.3463 23.8316 54.3463 24.2583V26.2175L53.391 25.2621C53.0903 24.9615 52.5957 24.9615 52.295 25.2621L51.7422 25.8101C51.4367 26.1108 51.4367 26.6054 51.7422 26.9061L54.3463 29.5102V33.2685L51.3009 31.513L50.3795 28.0796C50.2728 27.682 49.8606 27.4444 49.463 27.5511L48.7404 27.745C48.3427 27.8517 48.1051 28.2639 48.2118 28.6616L48.5513 29.9224L46.9122 28.9768C46.5533 28.7683 46.0975 28.8943 45.8889 29.2532L45.1373 30.548C44.9288 30.9068 45.0549 31.3627 45.4137 31.5712L47.0528 32.5168L45.792 32.8563C45.3895 32.963 45.1518 33.3752 45.2585 33.7777L45.4525 34.5002C45.5592 34.8979 45.9714 35.1355 46.369 35.0288L49.8024 34.1074L52.8963 35.8969L49.8024 37.6863L46.369 36.7649C45.9714 36.6582 45.5592 36.8958 45.4525 37.2935L45.2585 38.0161C45.1518 38.4137 45.3895 38.8259 45.7871 38.9326L47.048 39.2721L45.4089 40.2225C45.05 40.4311 44.9288 40.8869 45.1324 41.2458L45.8841 42.5454C46.0926 42.9042 46.5485 43.0255 46.9073 42.8218L48.5464 41.8762L48.207 43.137C48.1003 43.5347 48.3379 43.9469 48.7355 44.0536L49.4581 44.2475C49.8558 44.3542 50.268 44.1166 50.3746 43.7189L51.296 40.2856L54.3414 38.5301V42.2884L51.7373 44.8925C51.4318 45.1932 51.4318 45.6878 51.7373 45.9885L52.2853 46.5364C52.586 46.8371 53.0806 46.8371 53.3813 46.5364L54.3366 45.5811V47.5354C54.3366 47.9622 54.6858 48.3113 55.1125 48.3113H56.6643C57.0911 48.3113 57.4402 47.9622 57.4402 47.5354V45.5763L58.3955 46.5316C58.6962 46.8323 59.1908 46.8323 59.4915 46.5316L60.0395 45.9836C60.3401 45.6829 60.3401 45.1883 60.0395 44.8876L57.4499 42.2835V38.5252L60.4953 40.2807L61.4167 43.7141C61.5234 44.1117 61.9356 44.3494 62.3332 44.2427L63.0558 44.0487C63.4535 43.942 63.6911 43.5298 63.5844 43.1322L63.2449 41.8713L64.884 42.817C65.2429 43.0255 65.6987 42.8994 65.9072 42.5405L66.6589 41.2409C66.8674 40.8869 66.7462 40.4262 66.3873 40.2225V40.2225Z"
      fill="#756B61"
    />
  </ComponentBase>
</template>

<script setup lang="ts">
import AnimatedNumber from "vue-number-animation";
import { formattedInt } from "@/utils/numbers";
import { useObservable } from "@vueuse/rxjs";
import ComponentBase from "./ComponentBase.vue";
import { type PowerHubStore } from "@/stores/power-hub";

import { useAsWatts } from "@/utils";
import { map } from "rxjs";

const { powerHub } = defineProps<{ powerHub: PowerHubStore }>();

const { value, unit } = useAsWatts(
  useObservable(
    powerHub.sensors.useMqtt("cold_reservoir/fill_power").pipe(map(({ value }) => value)),
  ),
);
</script>
