<template>
  <ComponentBase
    component="compression-chiller"
    x="759"
    y="452"
    width="120"
    height="112"
    viewBox="0 0 120 112"
  >
    <rect
      x="1"
      width="111"
      height="112"
      rx="55.5"
      class="fill"
      fill="#ECD2D4"
    />
    <circle
      cx="57"
      cy="56"
      r="46"
      fill="white"
    />
    <text
      fill="#756B61"
      xml:space="preserve"
      style="white-space: pre"
      font-size="12"
      font-weight="bold"
      letter-spacing="0em"
    >
      <tspan
        x="19.9102"
        y="59.961"
      >
        Compression
      </tspan>
    </text>
    <text
      fill="#756B61"
      xml:space="preserve"
      style="white-space: pre"
      font-size="12"
      font-weight="bold"
      letter-spacing="0em"
    >
      <tspan
        x="39.3652"
        y="72.961"
      >
        chiller
      </tspan>
    </text>
    <text
      fill="#756B61"
      xml:space="preserve"
      style="white-space: pre"
      font-family="DMMono"
      font-size="10"
      letter-spacing="0em"
    >
      <AnimatedNumber
        tag="tspan"
        text-anchor="end"
        x="56"
        y="85.91"
        :from="value"
        :format="formattedInt"
      />
    </text>
    <text
      fill="#756B61"
      xml:space="preserve"
      style="white-space: pre"
      font-size="9"
      letter-spacing="0em"
    >
      <tspan
        x="60"
        y="85.91"
      >
        {{ unit }}
      </tspan>
    </text>
    <g clip-path="url(#clip0_518_1913)">
      <path
        d="M55.4247 31.5721C55.4041 31.8997 55.3863 32.2051 55.3656 32.5105C55.2747 33.8405 55.1834 33.9152 55.0916 35.2452C55.0025 36.5335 55.0184 35.9426 54.8325 37.2274C54.8141 37.6003 54.6794 37.8171 54.3941 38.0557C52.7728 39.4124 52.1506 41.1623 52.6728 43.2145C53.1934 45.2601 54.5712 46.5085 56.6334 46.9121C59.2956 47.4331 61.9481 45.5877 62.4037 42.9076C62.7625 40.7967 62.0375 39.0998 60.3212 37.8322C60.2403 37.7723 60.0884 37.8394 60.0316 37.0103C59.9528 35.8629 59.8731 35.9708 59.7947 34.8231C59.7212 33.7492 59.6484 32.6752 59.5731 31.5686C59.6497 31.6101 59.7069 31.6383 59.7613 31.6706C60.7213 32.2418 61.3906 33.0531 61.7587 34.1126C61.8812 34.465 62.0172 34.562 62.3944 34.5623C63.0766 34.5623 63.7587 34.563 64.4409 34.5623C64.8 34.562 65 34.3599 65 33.9977C65 29.5205 65 25.0437 65 20.5671C65 20.1949 64.8028 20 64.4278 20C59.8138 20 55.2 20 50.5859 20C50.1928 20 50 20.1927 50 20.5847C50 25.0459 50 29.5067 50 33.9679C50 34.3747 50.1869 34.5614 50.5928 34.5617C51.2803 34.5617 51.9675 34.562 52.655 34.5617C52.9681 34.5617 53.1216 34.4528 53.2247 34.1537C53.595 33.0782 54.2638 32.2472 55.2413 31.6691C55.2937 31.638 55.3488 31.612 55.4247 31.5718V31.5721ZM63.9928 33.5577C63.5897 33.5577 63.2044 33.5508 62.8194 33.5612C62.6744 33.565 62.6059 33.5223 62.5475 33.3826C61.4016 30.6388 58.1678 29.3075 55.4331 30.4514C54.0366 31.0358 53.0356 32.0278 52.4356 33.4231C52.3919 33.5251 52.3422 33.5634 52.2306 33.5606C51.9028 33.5527 51.5744 33.5577 51.2466 33.5577C51.1659 33.5577 51.0853 33.5577 51.0091 33.5577V25.0324H63.9928V33.5577ZM57.5106 45.9976C57.3241 45.9822 57.1366 45.9741 56.9513 45.9496C56.7969 45.9292 56.6438 45.8962 56.4925 45.8583C54.5469 45.3687 53.2266 43.3852 53.5397 41.4137C53.7378 40.1656 54.3678 39.1977 55.4422 38.533C56.0325 38.1727 55.9847 36.8373 56.0878 35.3193C56.2069 33.5719 56.3256 33.0801 56.4403 31.3323C56.4478 31.2181 56.4881 31.1691 56.5981 31.1462C57.1981 31.0207 57.7962 31.0201 58.3962 31.1456C58.5022 31.1679 58.5506 31.2109 58.5584 31.3279C58.6594 32.8563 58.7659 34.3844 58.87 35.9128C58.9887 37.6549 58.8409 38.1106 59.5397 38.5217C60.9547 39.4277 61.6225 40.7251 61.4688 42.4064C61.2838 44.4291 59.5406 45.9879 57.5106 45.9976ZM51.0037 21.0175H63.9894V21.9973H51.0037V21.0175ZM51.0094 24.0096V23.0235H63.9875V24.0096H51.0094Z"
        fill="#756B61"
      />
      <path
        d="M57.4985 26.0264C56.6728 26.027 56 26.7036 56.0006 27.5337C56.001 28.3626 56.6756 29.0392 57.5013 29.0383C58.3266 29.0376 59.0003 28.3594 58.9994 27.5309C58.9985 26.7021 58.3241 26.0261 57.4985 26.0264ZM57.4966 27.0306C57.7694 27.0288 57.9953 27.251 57.9994 27.5243C58.0031 27.797 57.7822 28.028 57.5116 28.0337C57.2331 28.0396 57.001 27.8115 57.001 27.5318C57.001 27.2594 57.2253 27.0322 57.4969 27.0306H57.4966Z"
        fill="#756B61"
      />
      <path
        d="M54.5 41.9767C54.505 43.646 55.8578 44.9902 57.5235 44.9814C59.1738 44.9726 60.5082 43.6115 60.4997 41.945C60.4916 40.2958 59.1394 38.9523 57.4913 38.9561C55.8369 38.9598 54.4947 40.315 54.4997 41.9771L54.5 41.9767ZM59.4994 41.962C59.5022 43.068 58.6085 43.9731 57.51 43.9771C56.4078 43.9809 55.5053 43.0855 55.5 41.9827C55.4947 40.8749 56.3857 39.9657 57.4819 39.9607C58.595 39.9556 59.4966 40.8498 59.4994 41.962Z"
        fill="#756B61"
      />
      <path
        d="M57.4966 27.0303C57.2253 27.0322 57.0007 27.2591 57.0007 27.5315C57.0007 27.8111 57.2328 28.0393 57.5113 28.0333C57.7819 28.0277 58.0032 27.7967 57.9991 27.524C57.995 27.2503 57.7691 27.0284 57.4963 27.0303H57.4966Z"
        fill="white"
      />
      <path
        d="M57.5053 42.9728C58.0572 42.97 58.5034 42.5149 58.4994 41.9594C58.4956 41.4058 58.0409 40.9592 57.4869 40.9649C56.9422 40.9705 56.5003 41.4206 56.5003 41.9701C56.5003 42.5237 56.9531 42.9756 57.505 42.9728H57.5053Z"
        fill="#756B61"
      />
    </g>
    <defs>
      <clipPath id="clip0_518_1913">
        <rect
          width="15"
          height="27"
          fill="white"
          transform="matrix(-1 0 0 1 65 20)"
        />
      </clipPath>
    </defs>
  </ComponentBase>
</template>

<script setup lang="ts">
import AnimatedNumber from "vue-number-animation";
import { formattedInt } from "@/utils/numbers";
import { useObservable } from "@vueuse/rxjs";
import ComponentBase from "./ComponentBase.vue";
import { type PowerHubStore } from "@/stores/power-hub";

import { useAsWatts } from "@/utils";
import { map } from "rxjs";

const { powerHub } = defineProps<{ powerHub: PowerHubStore }>();

const { value, unit } = useAsWatts(
  useObservable(powerHub.sensors.useMqtt("chiller/chill_power").pipe(map(({ value }) => value))),
);
</script>
