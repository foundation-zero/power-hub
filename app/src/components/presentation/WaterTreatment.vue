<template>
  <ComponentBase
    component="water-treatment"
    x="756"
    y="795"
    width="112"
    height="112"
    viewBox="-1 -1 114 114"
  >
    <rect
      width="111"
      height="111"
      rx="55.5"
      class="fill"
      fill="#86B4E8"
      stroke="#86B4E8"
    />
    <circle
      cx="56.0002"
      cy="56"
      r="46"
      fill="white"
    />
    <path
      d="M68.0003 40.8571C67.9543 41.1176 67.9229 41.3814 67.8601 41.638C67.4178 43.4483 65.9019 44.7941 64.052 45.0204C63.8357 45.0469 63.6158 45.052 63.3974 45.0525C61.9836 45.0553 60.5699 45.0539 59.1559 45.0539H58.9986C58.9986 45.1021 58.9986 45.1431 58.9986 45.1841C58.9986 45.5785 59 45.9728 58.9989 46.3671C58.9975 46.8614 58.7401 47.2569 58.3046 47.4375C57.8689 47.6182 57.407 47.5212 57.0566 47.1718C56.0392 46.1571 55.0225 45.1415 54.0062 44.1259C53.6577 43.7775 53.657 43.3344 54.0039 42.9875C55.0225 41.9683 56.0413 40.9494 57.0603 39.9309C57.3742 39.6172 57.7503 39.5076 58.1764 39.6278C58.5864 39.7435 58.8559 40.0155 58.9635 40.4323C58.9895 40.5331 58.9968 40.6406 58.9979 40.7451C59.0017 41.1354 58.9991 41.526 58.9989 41.9163C58.9989 41.9582 58.9989 42.0002 58.9989 42.0541C59.0443 42.0541 59.0783 42.0541 59.1123 42.0541C60.5612 42.0541 62.0101 42.0555 63.4593 42.0536C64.2641 42.0527 64.8669 41.5342 64.9864 40.7383C65.0408 40.3756 64.9475 40.0422 64.7542 39.7341C64.491 39.3143 64.2233 38.8973 63.9669 38.4734C63.4328 37.5899 63.9078 36.456 64.9161 36.2346C65.5271 36.1003 66.0697 36.2772 66.4271 36.7913C66.8359 37.3793 67.2003 38.0004 67.5507 38.626C67.8102 39.0887 67.9316 39.6048 67.9794 40.135C67.9822 40.1655 67.993 40.1952 68.0003 40.2252V40.8578V40.8571Z"
      fill="#756B61"
    />
    <path
      d="M44.0002 40.2252C44.0349 40.0141 44.0614 39.8012 44.1062 39.5922C44.2184 39.0683 44.4303 38.585 44.7144 38.1312C45.4742 36.9175 46.232 35.7025 46.9904 34.488C47.015 34.4486 47.0387 34.4083 47.0687 34.3589C46.951 34.2839 46.8376 34.2108 46.7234 34.1389C46.4692 33.9791 46.2134 33.821 45.9599 33.6602C45.5394 33.3939 45.3299 32.9557 45.4166 32.5057C45.5138 32.0013 45.8183 31.6941 46.3199 31.5784C47.7181 31.2562 49.1162 30.9322 50.5142 30.6089C50.9734 30.5028 51.3671 30.7427 51.4721 31.1993C51.7981 32.6163 52.1244 34.0332 52.4448 35.4516C52.5516 35.9251 52.4026 36.3218 52.0128 36.6064C51.6235 36.8906 51.2016 36.9145 50.7826 36.6666C50.4099 36.4462 50.0464 36.2105 49.6784 35.9818C49.6623 35.9717 49.6447 35.9635 49.6201 35.9506C49.5985 35.9797 49.5767 36.0055 49.5591 36.0338C48.7874 37.2676 48.0141 38.5006 47.2449 39.736C46.8479 40.3735 46.9388 41.1312 47.4695 41.6408C47.7491 41.9093 48.087 42.0473 48.4742 42.0513C48.9781 42.0564 49.482 42.0508 49.9857 42.0531C50.8611 42.0571 51.5225 42.7401 51.5005 43.6147C51.482 44.3541 50.863 45.0173 50.1177 45.0431C49.4471 45.0663 48.7719 45.0764 48.1039 45.0248C46.7127 44.9173 45.6177 44.2566 44.8147 43.1208C44.3551 42.4709 44.0938 41.7425 44.0204 40.9482C44.0176 40.9178 44.0073 40.888 44.0005 40.8578C44.0005 40.6469 44.0005 40.4361 44.0005 40.2252H44.0002Z"
      fill="#756B61"
    />
    <path
      d="M56.305 24.0586C56.5584 24.1005 56.8157 24.1265 57.0646 24.1875C58.2156 24.4691 59.1248 25.1063 59.7655 26.1018C60.4115 27.1055 61.0344 28.1242 61.6675 29.1363C61.6921 29.1757 61.7167 29.215 61.7472 29.264C61.9769 29.1208 62.2009 28.9814 62.4248 28.842C62.5804 28.745 62.7341 28.645 62.8921 28.552C63.3098 28.306 63.7295 28.3114 64.1252 28.5881C64.5252 28.8678 64.6851 29.2666 64.5787 29.7445C64.3159 30.9239 64.0403 32.1005 63.7696 33.278C63.7119 33.5287 63.6557 33.7799 63.5952 34.0299C63.4926 34.4542 63.1192 34.6988 62.6924 34.6025C61.6237 34.3616 60.5568 34.1112 59.4894 33.8645C59.1362 33.7827 58.783 33.7007 58.4296 33.6189C57.9609 33.5107 57.6311 33.1679 57.5521 32.7066C57.4743 32.2512 57.6693 31.817 58.0715 31.5626C58.4045 31.3522 58.7409 31.1465 59.0755 30.9385C59.1149 30.9141 59.1529 30.8878 59.1967 30.859C59.1801 30.8272 59.1674 30.7993 59.1515 30.7737C58.5283 29.774 57.9072 28.7729 57.2802 27.7753C56.7984 27.0087 55.7917 26.818 55.0895 27.3653C54.9477 27.4757 54.8319 27.6252 54.7241 27.7713C54.6018 27.9372 54.5024 28.12 54.3916 28.2947C54.0067 28.9013 53.2954 29.16 52.6298 28.936C51.9672 28.7132 51.5505 28.0703 51.6234 27.3571C51.64 27.1936 51.6819 27.0198 51.7609 26.878C52.0764 26.312 52.4094 25.756 52.8866 25.3038C53.6448 24.5853 54.5444 24.18 55.5829 24.079C55.6129 24.0762 55.6424 24.0654 55.6722 24.0586C55.8831 24.0586 56.0941 24.0586 56.305 24.0586Z"
      fill="#756B61"
    />
    <text
      fill="#FFFDFB"
      xml:space="preserve"
      style="white-space: pre"
      font-size="12"
      font-weight="bold"
      letter-spacing="0em"
    >
      <tspan
        x="37.9436"
        y="59.96"
      >
        Water
      </tspan>
    </text>
    <text
      fill="#756B61"
      xml:space="preserve"
      style="white-space: pre"
      font-size="12"
      font-weight="bold"
      letter-spacing="0em"
    >
      <tspan
        x="37.9435"
        y="61.96"
      >
        Water
      </tspan>
    </text>
    <text
      fill="#756B61"
      xml:space="preserve"
      style="white-space: pre"
      font-size="12"
      font-weight="bold"
      letter-spacing="0em"
    >
      <tspan
        x="27.5372"
        y="72.96"
      >
        treatment
      </tspan>
    </text>
    <text
      fill="#756B61"
      xml:space="preserve"
      style="white-space: pre"
      font-family="DMMono"
      font-size="10"
      letter-spacing="0em"
    >
      <AnimatedNumber
        tag="tspan"
        text-anchor="end"
        x="56"
        y="84.8"
        :to="value"
        :format="formattedInt"
      />
    </text>
    <text
      fill="#756B61"
      xml:space="preserve"
      style="white-space: pre"
      font-size="9"
      letter-spacing="0em"
    >
      <tspan
        x="58"
        y="84.8"
      >
        l/min
      </tspan>
    </text>
  </ComponentBase>
</template>

<script setup lang="ts">
import AnimatedNumber from "vue-number-animation";
import { useObservable } from "@vueuse/rxjs";
import ComponentBase from "./ComponentBase.vue";
import { type PowerHubStore } from "@/stores/power-hub";
import { formattedInt } from "@/utils/numbers";
import { map } from "rxjs";

const { powerHub } = defineProps<{ powerHub: PowerHubStore }>();

const value = useObservable(
  powerHub.sensors.useMqtt("water_treatment/out_flow").pipe(map(({ value }) => value * 60)),
);
</script>
