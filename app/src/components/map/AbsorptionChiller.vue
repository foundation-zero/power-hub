<template>
  <ComponentBase
    component="absorption-chiller"
    class="gradient"
    x="761"
    y="591"
    width="114"
    height="112"
    viewBox="0 0 114 112"
  >
    <rect
      x="115"
      y="111"
      width="111"
      height="112"
      rx="55.5"
      transform="rotate(180 113 112.001)"
      class="fill gradient"
      fill="url(#paint0_linear_512_1595)"
    />
    <circle
      cx="56"
      cy="57"
      r="46"
      fill="white"
    />
    <text
      fill="#6D6D6D"
      xml:space="preserve"
      style="white-space: pre"
      font-size="12"
      font-weight="bold"
      letter-spacing="0em"
    >
      <tspan
        x="26.5742"
        y="62.961"
      >
        Absorption
      </tspan>
    </text>
    <text
      fill="#6D6D6D"
      xml:space="preserve"
      style="white-space: pre"
      font-size="12"
      font-weight="bold"
      letter-spacing="0em"
    >
      <tspan
        x="39.8652"
        y="75.961"
      >
        chiller
      </tspan>
    </text>
    <text
      fill="#756B61"
      xml:space="preserve"
      style="white-space: pre"
      font-family="DMMono"
      font-size="10"
      letter-spacing="0em"
    >
      <AnimatedNumber
        tag="tspan"
        text-anchor="end"
        x="56"
        y="90"
        :to="value"
        :format="formattedInt"
      />
    </text>
    <text
      fill="#756B61"
      xml:space="preserve"
      style="white-space: pre"
      font-size="9"
      letter-spacing="0em"
    >
      <tspan
        x="58"
        y="90"
        >{{ unit }}</tspan
      >
    </text>
    <path
      d="M73.7186 38.0297L66.3593 38.7715L59 38.3957V37.6832L66.3593 36.9658L73.7186 37.283V37.6832V38.0297Z"
      fill="#756B61"
    />
    <path
      d="M66.1986 45.2382L65.4578 37.8691L65.833 30.5H66.5446L67.261 37.8691L66.9442 45.2382H66.5446H66.1986Z"
      fill="#756B61"
    />
    <path
      d="M71.4333 43.1935L65.7018 38.5085L60.7599 33.0329L61.2668 32.5254L66.9787 37.2299L71.9596 42.6664L71.677 42.9495L71.4333 43.1935Z"
      fill="#756B61"
    />
    <path
      d="M61.0229 42.9689L65.7017 37.2298L71.17 32.2812L71.6768 32.7888L66.9786 38.5084L61.5493 43.4959L61.2666 43.2129L61.0229 42.9689Z"
      fill="#756B61"
    />
    <path
      d="M43.2624 44.5C43.1582 44.5 43.0496 44.4709 42.9497 44.4127C42.6327 44.2186 42.5155 43.7772 42.6892 43.4231C43.6663 41.4196 43.9355 39.809 43.4926 38.635C43.3493 38.2518 43.1669 38.0093 42.9584 37.723C42.6979 37.3689 42.4026 36.9663 42.2245 36.3259C41.5341 33.881 42.5676 32.0667 43.5447 30.7618C43.7748 30.4513 44.1874 30.4125 44.461 30.6696C44.7345 30.9267 44.7736 31.3875 44.5435 31.6932C43.6923 32.8332 42.9715 34.1284 43.4665 35.8845C43.5707 36.258 43.7444 36.4957 43.9659 36.7965C44.2047 37.1215 44.474 37.4902 44.6911 38.0626C45.2991 39.6635 45.0081 41.7009 43.8313 44.1119C43.714 44.3545 43.4882 44.4903 43.2581 44.4903L43.2624 44.5Z"
      fill="#756B61"
    />
    <path
      d="M39.2624 44.5C39.1582 44.5 39.0496 44.4709 38.9497 44.4127C38.6327 44.2186 38.5155 43.7772 38.6892 43.4231C39.6663 41.4196 39.9355 39.809 39.4926 38.635C39.3493 38.2518 39.1669 38.0093 38.9584 37.723C38.6979 37.3689 38.4026 36.9663 38.2245 36.3259C37.5341 33.881 38.5676 32.0667 39.5447 30.7618C39.7748 30.4513 40.1874 30.4125 40.461 30.6696C40.7345 30.9267 40.7736 31.3875 40.5435 31.6932C39.6923 32.8332 38.9715 34.1284 39.4665 35.8845C39.5707 36.258 39.7444 36.4957 39.9659 36.7965C40.2047 37.1215 40.474 37.4902 40.6911 38.0626C41.2991 39.6635 41.0081 41.7009 39.8313 44.1119C39.714 44.3545 39.4882 44.4903 39.2581 44.4903L39.2624 44.5Z"
      fill="#756B61"
    />
    <path
      d="M47.2624 44.5C47.1582 44.5 47.0496 44.4709 46.9497 44.4127C46.6327 44.2186 46.5155 43.7772 46.6892 43.4231C47.6663 41.4196 47.9398 39.809 47.4926 38.635C47.3493 38.2518 47.1669 38.0093 46.9584 37.723C46.6979 37.3689 46.4026 36.9663 46.2245 36.3259C45.5341 33.881 46.5676 32.0667 47.5447 30.7618C47.7748 30.4513 48.1874 30.4125 48.461 30.6696C48.7345 30.9267 48.7736 31.3875 48.5435 31.6932C47.6923 32.8332 46.9715 34.1284 47.4665 35.8845C47.5707 36.258 47.7444 36.4957 47.9659 36.7965C48.2047 37.1215 48.474 37.4902 48.6911 38.0626C49.2991 39.6635 49.0081 41.7009 47.8313 44.1119C47.714 44.3545 47.4882 44.4903 47.2581 44.4903L47.2624 44.5Z"
      fill="#756B61"
    />
    <path
      d="M55.5 27L55.5 48"
      stroke="#6D6D6D"
      stroke-linecap="round"
    />

    <defs>
      <linearGradient
        id="paint0_linear_512_1595"
        x1="224"
        y1="168.001"
        x2="113"
        y2="168.001"
        gradientUnits="userSpaceOnUse"
      >
        <stop
          stop-color="#ECD2D4"
          class="from"
        />
        <stop
          offset="1"
          class="to"
          stop-color="#abe8ec"
        />
      </linearGradient>
    </defs>
  </ComponentBase>
</template>

<script setup lang="ts">
import AnimatedNumber from "vue-number-animation";
import { formattedInt } from "@/utils/numbers";
import { useObservable } from "@vueuse/rxjs";
import ComponentBase from "./ComponentBase.vue";
import { type PowerHubStore } from "@/stores/power-hub";

import { useAsWatts } from "@/utils";
import { map } from "rxjs";

const { powerHub } = defineProps<{ powerHub: PowerHubStore }>();

const { value, unit } = useAsWatts(
  useObservable(powerHub.sensors.useMqtt("yazaki/chill_power").pipe(map(({ value }) => value))),
);
</script>
