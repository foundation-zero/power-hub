<template>
  <ComponentBase
    component="heat-tubes"
    x="367"
    y="508"
    width="114"
    height="114"
    viewBox="-1 -1 114 114"
  >
    <rect
      width="112"
      height="112"
      rx="56"
      fill="white"
      stroke="#E6E6E6"
      stroke-width="1"
    />
    <circle
      cx="56.0001"
      cy="56"
      r="46"
      class="fill"
      fill="#ECD2D4"
    />
    <text
      fill="#756B61"
      xml:space="preserve"
      style="white-space: pre"
      font-family="DMMono"
      font-size="10"
      letter-spacing="0em"
    >
      <AnimatedNumber
        tag="tspan"
        text-anchor="end"
        x="56"
        y="83"
        :to="value"
        :format="formattedInt"
      />
    </text>
    <text
      fill="#756B61"
      xml:space="preserve"
      style="white-space: pre"
      font-size="9"
      letter-spacing="0em"
    >
      <tspan
        x="58"
        y="83"
        >{{ unit }}</tspan
      >
    </text>
    <text
      fill="#756B61"
      xml:space="preserve"
      style="white-space: pre"
      font-size="12"
      font-weight="bold"
      letter-spacing="0em"
    >
      <tspan
        x="25.0176"
        y="66.96"
      >
        Heat pipes
      </tspan>
    </text>
    <g clip-path="url(#clip0_518_1904)">
      <path
        d="M57.1349 31.9938C57.141 31.4952 57.4148 31.2311 57.938 31.2311C58.9525 31.2311 59.9683 31.2275 60.984 31.2311C61.5096 31.2335 61.7676 31.5095 61.77 32.0093C61.7737 32.8577 61.7749 43.0255 61.7712 46.5095C61.7737 47.2461 61.7737 47.9814 61.7688 48.718V48.7204C61.7639 49.2332 61.4595 49.4807 60.9559 49.4867C59.9585 49.4962 58.9598 49.4962 57.9624 49.4867C57.4246 49.4819 57.1312 49.2106 57.1312 48.674C57.1312 47.9779 57.1312 47.2818 57.1312 46.5857C57.1263 43.1921 57.1251 32.8505 57.1349 31.9938ZM58.3536 47.9767V48.2991C58.7227 48.3015 59.0906 48.3027 59.4598 48.3027C59.8289 48.3027 60.1858 48.3015 60.5489 48.2991C60.5513 47.7554 60.5513 47.1663 60.5489 46.5131C60.5526 43.2123 60.5513 34.5093 60.5489 32.4198C60.3545 32.4198 60.1614 32.4198 59.9683 32.4198H58.3548C58.3475 34.5735 58.3487 43.4015 58.3536 46.5845C58.3536 47.0509 58.3536 47.515 58.3536 47.9779V47.9767Z"
        fill="#756B61"
      />
      <path
        d="M50.192 31.9853C50.203 31.4951 50.4842 31.2226 51.0134 31.2297C51.5231 31.2345 52.0316 31.2297 52.5414 31.2297C53.0095 31.2297 53.4789 31.2226 53.947 31.2297C54.579 31.2404 54.81 31.4487 54.8173 32.0389C54.8284 33.0098 54.8173 47.7171 54.821 48.6893V48.6917C54.821 49.2033 54.5558 49.477 54.0436 49.4841C53.0254 49.4972 52.006 49.4948 50.9878 49.4841C50.4683 49.4794 50.1969 49.1819 50.1896 48.694C50.1737 47.7028 50.1712 32.9753 50.192 31.9841V31.9853ZM51.4095 48.299C51.8251 48.3026 52.215 48.3037 52.5939 48.3037C52.9374 48.3037 53.2735 48.3026 53.5987 48.299C53.5987 47.472 53.5987 45.5777 53.5987 43.2942C53.5987 39.2747 53.6011 33.9249 53.5962 32.4161C53.5412 32.4161 53.485 32.4161 53.43 32.4161C53.2833 32.4161 53.1379 32.4161 52.9912 32.4173C52.8408 32.4173 52.6905 32.4185 52.5414 32.4185C52.3727 32.4185 51.4474 32.4208 51.4107 32.4208C51.3972 34.8173 51.396 45.9239 51.4095 48.2978V48.299Z"
        fill="#756B61"
      />
      <path
        d="M41.0061 45.7285C41.0147 45.1026 41.253 44.8753 41.9021 44.8693C43.0266 44.8586 45.2757 44.8527 45.2757 44.8527L45.9945 44.8253L46.0336 44.8063V43.47H45.9982V42.4396H46.0336V39.3089H45.9982V36.5935H46.08V31.4198C46.0813 29.7087 46.9895 28.4712 48.5455 28.0988V28.0024C52.2761 28.0012 56.0054 28 59.736 28V28.0083H62.2284C64.2697 28.0083 65.4786 28.8686 65.8758 30.6773L65.9198 31.1782C65.9052 31.2151 65.9113 31.2068 65.9113 31.2532V43.664H65.8819C65.8819 43.9448 65.8819 44.2256 65.8819 44.5064C65.9076 44.5064 65.9333 44.5064 65.9577 44.5052C65.9577 44.5052 65.9577 44.5064 65.9577 44.5076C66.2071 44.5076 66.4564 44.5076 66.707 44.5076C67.0077 44.5136 67.3096 44.5267 67.6128 44.5505C67.999 44.5814 68.3829 44.5921 68.7557 44.5088C68.7972 44.5088 68.84 44.5088 68.8816 44.5088C69.8448 44.5124 69.9939 44.6528 69.9976 45.5666C70.0012 46.3996 70 47.2325 69.9976 48.0654C69.9939 48.9127 69.8228 49.084 68.9696 49.0876C67.9746 49.0911 66.9808 49.0876 65.9382 49.0876V49.1471H65.8807C65.8807 49.1673 65.8807 49.1863 65.8807 49.2066C65.8807 49.717 65.8599 50.2477 65.723 50.7356C65.3282 52.1445 64.0851 52.9774 62.4423 52.9786C58.5858 52.9822 54.7305 52.981 50.8741 52.981C50.3668 52.9869 49.8595 52.9929 49.3523 53C49.2154 53.0024 49.0833 53 48.9525 52.9952V52.9798H48.5455V52.8536C47.8488 52.7442 46.0165 52.198 46.0165 49.4719C44.7428 49.4719 43.463 49.4731 42.1845 49.4719C41.1675 49.4707 41.0049 49.3172 41.0025 48.3475C41.0012 47.4753 40.9939 46.6019 41.0061 45.7297V45.7285ZM42.4424 48.0726H45.9407C46.9834 48.0726 47.5077 48.5795 47.5151 49.5933C47.5139 51.0212 48.5027 51.4091 48.7533 51.4852V51.5995H59.7348V51.6078H62.3775C63.7343 51.6066 64.4518 50.8974 64.4543 49.5838C64.4555 48.9745 64.4543 48.3665 64.4543 47.7573H65.668C65.8098 47.7323 65.9638 47.7192 66.1313 47.7192H68.5418V45.8736C67.438 45.8736 66.3819 45.8808 65.3258 45.8713C64.7525 45.8653 64.519 45.6773 64.4689 45.1847C64.464 45.1811 64.4604 45.1775 64.4555 45.174C64.4555 44.8789 64.4555 44.5838 64.4555 44.2899C64.4555 44.1007 64.4371 43.9103 64.4274 43.7389C64.4188 43.7366 64.4127 43.7354 64.4054 43.733V30.6773C64.1646 29.8027 63.4409 29.3767 62.2492 29.3767C59.4977 29.3755 56.7474 29.3767 53.9959 29.3767H48.7545V29.4826C47.9184 29.7277 47.5187 30.3703 47.5163 31.4412C47.5139 32.9881 47.5163 34.535 47.5163 36.0819V36.5923H47.5921C47.5909 36.7708 47.5909 36.9505 47.5909 37.129H47.5725V37.2932H47.608C47.608 39.3517 47.6006 41.4091 47.5945 43.4676H47.5505V43.6759H47.5151C47.5151 44.2661 47.5187 44.7611 47.5151 45.2561C47.5102 46.0521 47.2889 46.2627 46.4529 46.2663C45.4945 46.2687 44.5375 46.2663 43.5791 46.2663H42.4436V48.0726H42.4424Z"
        fill="#756B61"
      />
    </g>
    <defs>
      <clipPath id="clip0_518_1904">
        <rect
          width="29"
          height="25"
          fill="white"
          transform="matrix(-1 0 0 1 70 28)"
        />
      </clipPath>
    </defs>
  </ComponentBase>
</template>

<script setup lang="ts">
import AnimatedNumber from "vue-number-animation";
import { formattedInt } from "@/utils/numbers";
import { useObservable } from "@vueuse/rxjs";
import ComponentBase from "./ComponentBase.vue";
import { type PowerHubStore } from "@/stores/power-hub";
import { useAsWatts } from "@/utils";
import { map } from "rxjs";
import { ref } from "vue";

const { powerHub } = defineProps<{ powerHub?: PowerHubStore }>();

const { value, unit } = useAsWatts(
  powerHub
    ? useObservable(powerHub.sensors.useMqtt("heat_pipes/power").pipe(map(({ value }) => value)))
    : ref(0),
);
</script>

<style scoped lang="scss">
#heat-tubes {
  will-change: transform;
  transition: transform 750ms ease;

  &.outlined {
    transition-duration: 3000ms;
    transform: scale(1.5, 1.5);
  }
}
</style>
